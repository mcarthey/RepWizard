<?xml version="1.0" encoding="utf-8" ?>
<!--
    TodayPage â€” Primary command center screen.

    Design per M3E spec (Section 13):
    - Context Header (top 10-15%): Date, greeting
    - Hero Performance Zone (center ~40%): Circular progress arc (SkiaSharp GraphicsView) + Start Workout CTA
    - Weekly Status Band (10-15%): Goal strip, streak indicator
    - Secondary Metrics Zone (lower third): 2x2 grid of MetricChipView controls
    - Bottom Navigation: TabBar (rendered by Shell)

    The Start Workout button uses breathing scale animation (ScaleXTo/ScaleYTo loop).
    Animations respect IMotionPreferenceService.IsReduceMotionEnabled.
-->
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:RepWizard.UI.ViewModels;assembly=RepWizard.UI"
             xmlns:controls="clr-namespace:RepWizard.UI.Controls;assembly=RepWizard.UI"
             xmlns:sys="clr-namespace:System;assembly=System.Runtime"
             x:Class="RepWizard.UI.Pages.TodayPage"
             x:DataType="vm:TodayViewModel"
             Title="{Binding Title}"
             BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceColor}, Dark={StaticResource SurfaceColorDark}}">

    <Shell.TitleView>
        <!-- Custom title bar omitted in Phase 1; uses default Shell title -->
    </Shell.TitleView>

    <Grid RowDefinitions="Auto,*,Auto,Auto,Auto,Auto">

        <!-- Error Banner -->
        <Border Grid.Row="5"
                IsVisible="{Binding HasError}"
                BackgroundColor="{StaticResource ErrorContainer}"
                StrokeThickness="0"
                Padding="12,8"
                Margin="12,0,12,8">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="8" />
            </Border.StrokeShape>
            <Label Text="{Binding ErrorMessage}"
                   TextColor="{StaticResource Error}"
                   FontSize="12"
                   LineBreakMode="WordWrap" />
        </Border>

        <!-- Context Header Band -->
        <VerticalStackLayout Grid.Row="0" Padding="24,16,24,8" Spacing="6">
            <HorizontalStackLayout Spacing="8" VerticalOptions="Center">
                <Image Source="repwizard_logo.png"
                       WidthRequest="40" HeightRequest="40"
                       Aspect="AspectFit"
                       VerticalOptions="Center" />
                <Label Text="REPWIZARD" FontSize="20" FontAttributes="Bold"
                       TextColor="{StaticResource Primary}"
                       VerticalOptions="Center"
                       CharacterSpacing="3" />
            </HorizontalStackLayout>
            <Label Text="{Binding Source={x:Static sys:DateTime.Now}, StringFormat='{0:dddd, MMMM d}'}"
                   FontSize="13" Opacity="0.6" Margin="0,4,0,0" />
            <Label Text="{Binding GreetingText}" FontSize="22" FontAttributes="Bold" />
        </VerticalStackLayout>

        <!-- Hero Performance Zone: Circular Progress + CTA -->
        <Grid Grid.Row="1" Padding="24">
            <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center" Spacing="20">

                <!-- Circular Progress Arc â€” Phase 1 placeholder; Phase 2+ uses SkiaSharp GraphicsView -->
                <Border StrokeShape="RoundRectangle 999"
                        Stroke="{StaticResource Primary}"
                        StrokeThickness="4"
                        BackgroundColor="{StaticResource SurfaceVariant}"
                        WidthRequest="200"
                        HeightRequest="200"
                        HorizontalOptions="Center">
                    <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center">
                        <Label Text="{Binding WeeklyProgressPercent, StringFormat='{0:F0}%'}"
                               FontSize="40" FontAttributes="Bold" HorizontalOptions="Center" />
                        <Label Text="Weekly Complete" FontSize="13" Opacity="0.6" HorizontalOptions="Center" />
                        <Label Text="{Binding WorkoutsThisWeek, StringFormat='{0} / {1} workouts'}"
                               FontSize="13" HorizontalOptions="Center">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="{Binding WorkoutsThisWeek}" FontAttributes="Bold" />
                                    <Span Text=" / " />
                                    <Span Text="{Binding WeeklyWorkoutGoal}" />
                                    <Span Text=" workouts" />
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                    </VerticalStackLayout>
                </Border>

                <!-- Primary CTA â€” Start Workout -->
                <Button x:Name="StartWorkoutButton"
                        Text="START WORKOUT"
                        Command="{Binding StartWorkoutCommand}"
                        CornerRadius="32"
                        HeightRequest="60"
                        MinimumWidthRequest="280"
                        FontAttributes="Bold"
                        FontSize="16"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="White"
                        Shadow="{Shadow Brush={StaticResource Primary}, Offset='0,4', Radius=12, Opacity=0.4}" />

            </VerticalStackLayout>
        </Grid>

        <!-- Scheduled Workout Card -->
        <Border Grid.Row="2"
                IsVisible="{Binding HasScheduledWorkout}"
                BackgroundColor="{StaticResource SurfaceVariant}"
                StrokeShape="RoundRectangle 12"
                StrokeThickness="0"
                Margin="16,0,16,8"
                Padding="16,12">
            <VerticalStackLayout Spacing="4">
                <HorizontalStackLayout Spacing="8">
                    <Label Text="{Binding ScheduledProgramName}"
                           FontSize="14" FontAttributes="Bold" />
                    <Label Text="{Binding ScheduledWeekInfo}"
                           FontSize="12" Opacity="0.6" VerticalOptions="Center" />
                </HorizontalStackLayout>
                <Label Text="{Binding NextWorkoutFocus}"
                       FontSize="16"
                       TextColor="{StaticResource Primary}" />
            </VerticalStackLayout>
        </Border>

        <!-- Weekly Status Band -->
        <Border Grid.Row="3"
                BackgroundColor="{StaticResource SurfaceVariant}"
                Padding="24,12"
                StrokeThickness="0">
            <HorizontalStackLayout Spacing="16">
                <Label Text="ðŸ”¥" FontSize="20" IsVisible="{Binding CurrentStreakDays, Converter={StaticResource GreaterThanZeroConverter}}" />
                <Label VerticalOptions="Center">
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="{Binding CurrentStreakDays}" FontAttributes="Bold" />
                            <Span Text="-day streak" />
                        </FormattedString>
                    </Label.FormattedText>
                </Label>
            </HorizontalStackLayout>
        </Border>

        <!-- Secondary Metrics Zone â€” 2x2 grid -->
        <Grid Grid.Row="4" Padding="16" ColumnDefinitions="*,*" RowDefinitions="*,*" ColumnSpacing="12" RowSpacing="12">
            <controls:MetricChipView Grid.Row="0" Grid.Column="0"
                                     Icon="icon_workouts.png"
                                     Label="Workouts"
                                     Value="{Binding WorkoutsThisWeek}" />
            <controls:MetricChipView Grid.Row="0" Grid.Column="1"
                                     Icon="icon_time.png"
                                     Label="Minutes"
                                     Value="{Binding MinutesTrainedThisWeek}" />
            <controls:MetricChipView Grid.Row="1" Grid.Column="0"
                                     Icon="icon_volume.png"
                                     Label="Volume (kg)"
                                     Value="{Binding TotalVolumeThisWeek}" />
            <controls:MetricChipView Grid.Row="1" Grid.Column="1"
                                     Icon="icon_streak.png"
                                     Label="Streak"
                                     Value="{Binding CurrentStreakDays}" />
        </Grid>

    </Grid>

</ContentPage>
