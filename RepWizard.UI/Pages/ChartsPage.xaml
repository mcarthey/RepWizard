<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:RepWizard.UI.ViewModels"
             x:Class="RepWizard.UI.Pages.ChartsPage"
             x:DataType="vm:ChartsViewModel"
             BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceColor}, Dark={StaticResource SurfaceColorDark}}"
             Title="Charts">

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="12">

            <!-- Summary metrics row -->
            <Border Style="{StaticResource HeroSurface}" Padding="16">
                <Grid ColumnDefinitions="*,*,*">
                    <VerticalStackLayout Grid.Column="0" HorizontalOptions="Center">
                        <Label Text="{Binding TotalVolumeThisWeek, StringFormat='{0:N0}'}"
                               Style="{StaticResource MetricValueLabel}"
                               HorizontalOptions="Center" />
                        <Label Text="VOL THIS WEEK"
                               Style="{StaticResource SubheadingLabel}"
                               HorizontalOptions="Center" />
                    </VerticalStackLayout>
                    <VerticalStackLayout Grid.Column="1" HorizontalOptions="Center">
                        <Label Text="{Binding TotalSetsThisWeek}"
                               Style="{StaticResource MetricValueLabel}"
                               HorizontalOptions="Center" />
                        <Label Text="SETS THIS WEEK"
                               Style="{StaticResource SubheadingLabel}"
                               HorizontalOptions="Center" />
                    </VerticalStackLayout>
                    <VerticalStackLayout Grid.Column="2" HorizontalOptions="Center">
                        <Label Text="{Binding WeightChangeSinceStart, StringFormat='{0:+#.#;-#.#;0} kg'}"
                               Style="{StaticResource MetricValueLabel}"
                               HorizontalOptions="Center" />
                        <Label Text="WEIGHT CHANGE"
                               Style="{StaticResource SubheadingLabel}"
                               HorizontalOptions="Center" />
                    </VerticalStackLayout>
                </Grid>
            </Border>

            <!-- Time range selector -->
            <HorizontalStackLayout HorizontalOptions="Center" Spacing="8">
                <Button Text="4W" Style="{StaticResource SecondaryButton}"
                        Command="{Binding ChangeTimeRangeCommand}"
                        CommandParameter="4" />
                <Button Text="12W" Style="{StaticResource SecondaryButton}"
                        Command="{Binding ChangeTimeRangeCommand}"
                        CommandParameter="12" />
                <Button Text="6M" Style="{StaticResource SecondaryButton}"
                        Command="{Binding ChangeTimeRangeCommand}"
                        CommandParameter="26" />
                <Button Text="1Y" Style="{StaticResource SecondaryButton}"
                        Command="{Binding ChangeTimeRangeCommand}"
                        CommandParameter="52" />
            </HorizontalStackLayout>

            <!-- Personal Records section -->
            <Label Text="PERSONAL RECORDS"
                   Style="{StaticResource SubheadingLabel}"
                   Margin="0,8,0,0" />

            <CollectionView ItemsSource="{Binding PersonalRecords}"
                            EmptyView="Log workouts to track your personal records.">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="dto:ExercisePRDto"
                                  xmlns:dto="clr-namespace:RepWizard.Shared.DTOs;assembly=RepWizard.Shared">
                        <Border Style="{StaticResource ElevatedSurface}" Margin="0,0,0,6">
                            <Grid ColumnDefinitions="*,Auto,Auto">
                                <Label Grid.Column="0"
                                       Text="{Binding ExerciseName}"
                                       VerticalOptions="Center" />
                                <Label Grid.Column="1"
                                       Text="{Binding BestWeightKg, StringFormat='{0:N1} kg × '}"
                                       Style="{StaticResource MetricValueLabel}"
                                       FontSize="16"
                                       VerticalOptions="Center" />
                                <Label Grid.Column="2"
                                       Text="{Binding BestReps, StringFormat='{0} reps'}"
                                       TextColor="{AppThemeBinding Light={StaticResource Tertiary}, Dark={StaticResource TertiaryDark}}"
                                       FontFamily="OpenSansSemibold"
                                       VerticalOptions="Center" />
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Placeholder for chart visualizations — Phase 4 will wire in LiveCharts/Microcharts -->
            <Border Style="{StaticResource TonalSurface}" MinimumHeightRequest="200">
                <VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center">
                    <Label Text="Volume Chart"
                           Style="{StaticResource SubheadingLabel}"
                           HorizontalOptions="Center" />
                    <Label Text="Chart rendering (LiveCharts/Microcharts) wired in Phase 4"
                           FontSize="12"
                           TextColor="{AppThemeBinding Light={StaticResource OnSurfaceVariant}, Dark={StaticResource OnSurfaceVariantDark}}"
                           HorizontalOptions="Center"
                           HorizontalTextAlignment="Center"
                           Margin="16,8" />
                </VerticalStackLayout>
            </Border>

            <ActivityIndicator IsRunning="{Binding IsLoading}"
                               IsVisible="{Binding IsLoading}" />
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
